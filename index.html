<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RSSフィード表示</title>
</head>
<body>

<script>
// RSSフィードを取得して表示する関数
async function fetchRSSFeed() {
  //const url = 'https://samplerssfeed.com?url=https://b.hatena.ne.jp/hotentry/it.rss';
  const url = 'https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fb.hatena.ne.jp%2Fhotentry%2Fit.rss';

  try {
    const response = await fetch(url);

    if (!response.ok) {
      throw new Error('ネットワークの問題でRSSを取得できませんでした');
    }

    // const rssText = await response.text();
    // const parser = new DOMParser();
    // const rssDoc = parser.parseFromString(rssText, "application/xml");

    // フィードの各アイテムを表示
    //                const items = rssDoc.querySelectorAll('item');


    const b = await response.json()
      console.log(b)
      const feed = b.feed
      const channel = `
      <channel rdf:about="${feed.link}">
      <title>${feed.title}</title>
      <link>${feed.link}</link>
      <description>${feed.description}</description>
      </channel>
      `


      const items = []

      let rssContent = '';

    b.items.forEach(item => {
        // const title = item.querySelector('title').textContent;
        // const link = item.querySelector('link').textContent;
        // const description = item.querySelector('description').textContent;
        const title = item.title;
        const link = item.link;
        const description = item.description;

        rssContent += `<h2><a href="${link}" target="_blank">${title}</a></h2>`;
        rssContent += `<p>${description}</p>`;
        const i = `
        <item rdf:about="${item.link}">
        <title>${item.title}</title>
        <link>${item.link}</link>
        <description>${item.description}</description>
        <dc:date>${item.pubDate}</dc:date>
        ${item.categories.map(c => "<dc:subject>"+c+"</dc:subject>").join('')}
        <content:encoded>${item.content}</content:encoded>
        </item>`
        items.push(i)
        });

    //document.getElementById('rss-feed').innerHTML = rssContent;
  document.body.innerHTML = `<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://purl.org/rss/1.0/" xmlns:admin="http://webns.net/mvcb/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:hatena="http://www.hatena.ne.jp/info/xmlns#" xmlns:syn="http://purl.org/rss/1.0/modules/syndication/" xmlns:taxo="http://purl.org/rss/1.0/modules/taxonomy/">` + channel + items.join('') + `</rdf:RDF>`
  } catch (error) {
    console.error('エラー:', error);
    document.getElementById('rss-feed').innerText = 'RSSフィードを読み込む際にエラーが発生しました。';
  }

}

// ページが読み込まれたらRSSフィードを取得
window.onload = fetchRSSFeed;
</script>
</body>
</html>

